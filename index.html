<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Evolve Landscape Max</title>
    <style>
        /* --- å…¨å±€è¨­å®š --- */
        body {
            background-color: #121212;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* æŒ‰éˆ•å„ªåŒ– */
        button { touch-action: manipulation; outline: none; -webkit-tap-highlight-color: transparent; }
        .btn { border: none; color: white; border-radius: 8px; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center; transition: transform 0.1s; }
        .btn:active { transform: scale(0.95); opacity: 0.9; }

        /* --- ç•«é¢ 1: é ˜è¢–é¸æ“‡ (ç¶­æŒä¸è®Š) --- */
        #screen-select {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            background: #1a1a1a;
            z-index: 20;
            position: absolute; width: 100%;
        }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        .leader-opt { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #555; overflow: hidden; position: relative; }
        .leader-opt.selected { border-color: #00d2ff; box-shadow: 0 0 15px #00d2ff; }
        .leader-opt img { width: 100%; height: 100%; object-fit: cover; }
        .upload-placeholder { background: #444; font-size: 30px; color: #aaa; display: flex; justify-content: center; align-items: center; }

        /* --- ç•«é¢ 2: æˆ°é¬¥ä»‹é¢ (å·¦å³ä½ˆå±€) --- */
        #screen-battle {
            display: none; /* é è¨­éš±è— */
            flex-direction: row; /* é—œéµï¼šå·¦å³æ’åˆ— */
            height: 100%;
            width: 100%;
        }

        /* === å·¦å´ï¼šPP æ§åˆ¶å€ (30% å¯¬åº¦) === */
        .left-panel-pp {
            width: 30%;
            background-color: #1a1a1a;
            border-right: 2px solid #333;
            display: flex;
            flex-direction: column;
            padding: 10px;
            box-sizing: border-box;
            justify-content: space-around;
        }

        .pp-display-box { text-align: center; margin-bottom: 10px; }
        .pp-label { font-size: 0.8rem; color: #888; letter-spacing: 2px; }
        .pp-value { font-size: 3.5rem; font-weight: bold; color: #4eff4e; line-height: 1.1; }
        .pp-max-text { color: #aaa; font-size: 1rem; }
        
        /* PP æŒ‰éˆ•ç¾¤ */
        .pp-btn-group { display: flex; gap: 5px; margin-bottom: 8px; }
        .btn-pp { flex: 1; background: #333; border: 1px solid #555; padding: 12px 0; font-size: 1.2rem; }
        
        /* å›åˆé–‹å§‹æŒ‰éˆ• */
        .btn-turn-start {
            width: 100%; padding: 20px 0;
            background: linear-gradient(135deg, #0056b3, #004494);
            font-size: 1.1rem; border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.4);
        }

        /* === å³å´ï¼šHP é¡¯ç¤ºå€ (70% å¯¬åº¦) === */
        .right-panel-hp {
            width: 70%;
            display: flex;
            flex-direction: column; /* å³å´å…§éƒ¨ä¸Šä¸‹æ’åˆ— */
        }

        /* å³ä¸Šï¼šå°æ‰‹å€ (40%) */
        .section-enemy {
            height: 40%;
            background-color: #251818;
            border-bottom: 2px solid #444;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* å³ä¸‹ï¼šç©å®¶å€ (60%) - ç©ºé–“ç•™çµ¦å¤§åœ– */
        .section-player {
            height: 60%;
            background-color: #181d25;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* é€šç”¨ HP æ§åˆ¶çµ„ */
        .hp-control-group {
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 5; /* ç¢ºä¿æŒ‰éˆ•åœ¨åœ–ç‰‡ä¸Šå±¤ */
        }
        
        /* ç©å®¶å¤§åœ–æ¨£å¼ (160px) */
        .avatar-large {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            border: 4px solid #fff;
            object-fit: cover;
            background: #000;
            box-shadow: 0 5px 20px rgba(0,0,0,0.6);
        }

        /* ç©å®¶ HP æ–‡å­— (ç–ŠåŠ åœ¨åœ–ç‰‡ä¸‹æ–¹æˆ–æ—é‚Š) */
        .hp-text-large {
            font-size: 4rem;
            font-weight: 800;
            color: #fff;
            text-shadow: 0 2px 5px rgba(0,0,0,0.8);
            position: absolute;
            bottom: -10px; right: -10px; /* ç¨å¾®é‡ç–Š */
        }
        
        /* å°æ‰‹å°åœ–æ¨£å¼ */
        .avatar-small { width: 70px; height: 70px; border-radius: 50%; border: 2px solid #ccc; object-fit: cover; }
        .hp-text-small { font-size: 3rem; font-weight: bold; min-width: 60px; text-align: center; }

        /* HP æŒ‰éˆ• */
        .btn-hp { width: 60px; height: 60px; border-radius: 50%; font-size: 2rem; background: #444; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        .btn-minus { background: #b71c1c; }
        .btn-plus { background: #1b5e20; }

        /* ç©å®¶é¡¯ç¤ºå®¹å™¨ (ç½®ä¸­) */
        .player-display-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        /* === éª°å­åŠŸèƒ½ (ä½æ–¼å³ä¸‹è§’) === */
        .dice-container {
            position: absolute;
            bottom: 15px;
            right: 15px;
            z-index: 10;
        }
        .dice-btn {
            width: 50px; height: 50px;
            background: white; color: black;
            border-radius: 10px;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.5rem; font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
            cursor: pointer; border: 2px solid #999;
        }

        /* æ—‹è½‰æŒ‰éˆ• */
        .btn-rotate { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.5); padding: 5px 10px; font-size: 0.8rem; border: 1px solid #666; }

        /* æ©«å‘æ¨¡å¼æç¤º (é¸ç”¨) */
        @media (orientation: portrait) {
            .landscape-hint {
                position: fixed; top:0; left:0; width:100%; height:100%;
                background: rgba(0,0,0,0.85); z-index: 100;
                display: flex; justify-content: center; align-items: center; color: white;
                text-align: center; pointer-events: none; opacity: 0; animation: fadeOut 3s forwards;
            }
        }
        @keyframes fadeOut { 0% {opacity: 1;} 80% {opacity: 1;} 100% {opacity: 0; pointer-events: none;} }

    </style>
</head>
<body>

<!-- æ©«å‘æç¤º (åªé¡¯ç¤º3ç§’) -->
<div class="landscape-hint">
    å»ºè­°å°‡æ‰‹æ©Ÿ<br>è½‰ç‚ºæ©«å‘ä½¿ç”¨
</div>

<!-- ç•«é¢ 1: é ˜è¢–é¸æ“‡ -->
<div id="screen-select">
    <h2 style="color: #00d2ff; margin-bottom: 20px;">SELECT LEADER</h2>
    <div class="grid">
        <div class="leader-opt" onclick="selectLeader(this, 'https://via.placeholder.com/200/2E7D32/FFFFFF?text=Elf')"><img src="https://via.placeholder.com/200/2E7D32/FFFFFF?text=Elf"></div>
        <div class="leader-opt" onclick="selectLeader(this, 'https://via.placeholder.com/200/FBC02D/000000?text=Royal')"><img src="https://via.placeholder.com/200/FBC02D/000000?text=Royal"></div>
        <div class="leader-opt" onclick="selectLeader(this, 'https://via.placeholder.com/200/1565C0/FFFFFF?text=Witch')"><img src="https://via.placeholder.com/200/1565C0/FFFFFF?text=Witch"></div>
        <div class="leader-opt" onclick="selectLeader(this, 'https://via.placeholder.com/200/424242/FFFFFF?text=Drag')"><img src="https://via.placeholder.com/200/424242/FFFFFF?text=Drag"></div>
        
        <label class="leader-opt upload-placeholder" onclick="triggerUpload(this)">
            +
            <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleUpload(this)">
        </label>
    </div>
    <button class="btn" style="background: #00d2ff; color: #000; padding: 15px 40px; margin-top: 20px; font-size: 1.2rem; border-radius: 30px;" onclick="startGame()">BATTLE START</button>
</div>

<!-- ç•«é¢ 2: æˆ°é¬¥ä»‹é¢ (å·¦å³ä½ˆå±€) -->
<div id="screen-battle">
    
    <!-- === å·¦å´ï¼šPP æ§åˆ¶ === -->
    <div class="left-panel-pp">
        <div class="pp-display-box">
            <div class="pp-label">PLAY POINTS</div>
            <div class="pp-value" id="currentPP">0</div>
            <div class="pp-max-text">MAX: <span id="maxPP">0</span></div>
        </div>

        <div>
            <div class="pp-label" style="text-align: center; margin-bottom: 5px;">PP Control</div>
            <div class="pp-btn-group">
                <button class="btn btn-pp" onclick="modPP(-1)">-1</button>
                <button class="btn btn-pp" onclick="modPP(1)">+1</button>
            </div>
            <div class="pp-btn-group">
                <button class="btn btn-pp" style="font-size: 1rem; color: #aaa;" onclick="modMaxPP(-1)">Max-</button>
                <button class="btn btn-pp" style="font-size: 1rem; color: #aaa;" onclick="modMaxPP(1)">Max+</button>
            </div>
        </div>

        <button class="btn btn-turn-start" onclick="startTurn()">
            å›åˆé–‹å§‹<br><span style="font-size: 0.9rem; font-weight: normal;">TURN START</span>
        </button>
        
        <div style="text-align: center; color: #666; font-size: 0.8rem;">
            Turn: <span id="turnCount">1</span>
        </div>
    </div>

    <!-- === å³å´ï¼šé›™æ–¹ç”Ÿå‘½å€¼ === -->
    <div class="right-panel-hp">
        
        <!-- å³ä¸Šï¼šå°æ‰‹ -->
        <div class="section-enemy" id="enemySection">
            <button class="btn btn-rotate" onclick="rotateEnemy()">â†»</button>
            <div class="hp-control-group">
                <button class="btn btn-hp btn-minus" onclick="modHP('enemy', -1)" style="width: 50px; height: 50px;">-</button>
                <div style="text-align: center;">
                    <img src="https://via.placeholder.com/150/333/FFF?text=Enemy" class="avatar-small">
                    <div class="hp-text-small" id="enemyHP">20</div>
                </div>
                <button class="btn btn-hp btn-plus" onclick="modHP('enemy', 1)" style="width: 50px; height: 50px;">+</button>
            </div>
        </div>

        <!-- å³ä¸‹ï¼šç©å®¶ (å¤§åœ– + éª°å­) -->
        <div class="section-player">
            <div class="hp-control-group">
                <button class="btn btn-hp btn-minus" onclick="modHP('player', -1)">-</button>
                
                <!-- å¤§ä¸»æˆ°è€…åœ–ç‰‡é¡¯ç¤ºå€ -->
                <div class="player-display-container">
                    <!-- å¤§åœ–ç‰‡ (160px) -->
                    <img id="myAvatar" src="" class="avatar-large">
                    <!-- HP æ–‡å­— (ç–ŠåŠ ) -->
                    <div class="hp-text-large" id="playerHP">20</div>
                </div>
                
                <button class="btn btn-hp btn-plus" onclick="modHP('player', 1)">+</button>
            </div>

            <!-- éª°å­åŠŸèƒ½ (ä½æ–¼å³ä¸‹è§’) -->
            <div class="dice-container" onclick="rollDice()">
                <div class="dice-btn" id="diceResult">ğŸ²</div>
            </div>
        </div>

    </div>
</div>

<script>
    // éŠæˆ²æ ¸å¿ƒæ•¸æ“š
    let state = {
        playerHP: 20, enemyHP: 20,
        currentPP: 0, maxPP: 0,
        turn: 1, imgSrc: ''
    };

    // 1. éª°å­é‚è¼¯ (Source [2])
    function rollDice() {
        const result = Math.floor(Math.random() * 6) + 1;
        const diceEl = document.getElementById('diceResult');
        diceEl.style.transform = "rotate(360deg) scale(0.8)";
        setTimeout(() => {
            diceEl.innerText = result;
            diceEl.style.transform = "rotate(0deg) scale(1)";
        }, 200);
    }

    // 2. åœ–ç‰‡è™•ç† (Source [3])
    function selectLeader(el, src) {
        document.querySelectorAll('.leader-opt').forEach(d => d.classList.remove('selected'));
        el.classList.add('selected');
        state.imgSrc = src;
    }
    
    function triggerUpload(el) {
        document.querySelectorAll('.leader-opt').forEach(d => d.classList.remove('selected'));
        el.classList.add('selected');
    }

    function handleUpload(input) {
        if (input.files && input.files) {
            const reader = new FileReader();
            reader.onload = function(e) {
                state.imgSrc = e.target.result;
                input.parentElement.innerHTML = `<img src="${e.target.result}">`;
            }
            reader.readAsDataURL(input.files);
        }
    }

    // 3. é–‹å§‹éŠæˆ²
    function startGame() {
        if (!state.imgSrc) { alert("è«‹é¸æ“‡æˆ–ä¸Šå‚³ä¸€å¼µåœ–ç‰‡"); return; }
        document.getElementById('myAvatar').src = state.imgSrc;
        document.getElementById('screen-select').style.display = 'none';
        document.getElementById('screen-battle').style.display = 'flex'; // å•Ÿå‹• flex å·¦å³ä½ˆå±€
    }

    // 4. HP é‚è¼¯ (Source [1])
    function modHP(who, val) {
        if (who === 'player') {
            state.playerHP += val;
            document.getElementById('playerHP').innerText = state.playerHP;
        } else {
            state.enemyHP += val;
            document.getElementById('enemyHP').innerText = state.enemyHP;
        }
    }

    // 5. PP é‚è¼¯
    function modPP(val) {
        const next = state.currentPP + val;
        if (next >= 0 && next <= state.maxPP) {
            state.currentPP = next; renderPP();
        }
    }
    function modMaxPP(val) {
        const next = state.maxPP + val;
        if (next >= 0 && next <= 10) {
            state.maxPP = next; renderPP();
        }
    }
    function renderPP() {
        document.getElementById('currentPP').innerText = state.currentPP;
        document.getElementById('maxPP').innerText = state.maxPP;
    }

    // 6. å›åˆé–‹å§‹é‚è¼¯ (Source [1])
    function startTurn() {
        if (state.maxPP < 10) state.maxPP++;
        state.currentPP = state.maxPP;
        state.turn++;
        renderPP();
        document.getElementById('turnCount').innerText = state.turn;
    }

    // 7. æ—‹è½‰å°æ‰‹
    let isRotated = false;
    function rotateEnemy() {
        const section = document.getElementById('enemySection');
        section.style.transform = isRotated ? "none" : "rotate(180deg)";
        isRotated = !isRotated;
    }
</script>

</body>
</html>
