<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Evolve Battle Station</title>
    <style>
        /* 全局設定 */
        body {
            background-color: #121212;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            height: 100vh;
            overflow: hidden; /* 防止滾動 */
            display: flex;
            flex-direction: column;
        }

        /* 畫面 1: 領袖選擇 (保持不變，簡化顯示) */
        #screen-select {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            background: #1a1a1a;
            z-index: 10;
        }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        .leader-opt { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #555; overflow: hidden; cursor: pointer; }
        .leader-opt.selected { border-color: #00d2ff; box-shadow: 0 0 15px #00d2ff; }
        .leader-opt img { width: 100%; height: 100%; object-fit: cover; }
        .btn-start { margin-top: 20px; padding: 10px 30px; background: #00d2ff; border: none; font-size: 1.2rem; border-radius: 20px; cursor: pointer; }

        /* 畫面 2: 戰鬥介面 (核心修改區) */
        #screen-battle {
            display: none; /* 預設隱藏 */
            flex-direction: row; /* 左側 PP，右側 HP */
            height: 100%;
            width: 100%;
        }

        /* --- 左側：PP 控制區 (直式) --- */
        .left-panel-pp {
            width: 25%; /* 佔寬度 25% */
            background-color: #1e1e1e;
            border-right: 2px solid #333;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px;
            box-sizing: border-box;
        }

        .pp-display-box {
            margin-bottom: 20px;
            text-align: center;
        }
        .pp-label { font-size: 0.9rem; color: #888; letter-spacing: 2px; }
        .pp-value { font-size: 3.5rem; font-weight: bold; color: #4eff4e; text-shadow: 0 0 10px rgba(78, 255, 78, 0.3); }
        .pp-max { font-size: 1.2rem; color: #aaa; }

        .pp-controls { display: flex; flex-direction: column; gap: 10px; width: 100%; }
        .btn-pp { background: #333; color: white; border: 1px solid #555; padding: 12px; font-size: 1.2rem; border-radius: 8px; cursor: pointer; }
        .btn-pp:active { background: #555; }
        
        /* 回合開始按鈕 (重要功能) */
        .btn-turn-start {
            margin-top: 30px;
            background: linear-gradient(135deg, #0056b3, #004494);
            color: white;
            border: none;
            padding: 20px 10px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 12px;
            width: 100%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        .btn-turn-start:active { transform: scale(0.98); }

        /* --- 右側：HP 顯示區 (上下分割) --- */
        .right-panel-hp {
            width: 75%; /* 佔寬度 75% */
            display: flex;
            flex-direction: column;
        }

        .player-section {
            flex: 1; /* 上下各佔 50% */
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            border-bottom: 1px solid #333;
            position: relative;
        }
        
        /* 區分背景色 */
        .enemy-area { background-color: #251818; } /* 對手紅色調 */
        .self-area { background-color: #181d25; border-bottom: none; } /* 自己藍色調 */

        /* 領袖頭像 */
        .leader-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid #fff;
            object-fit: cover;
            background: #000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        /* HP 數值與按鈕 */
        .hp-control-group {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .hp-value {
            font-size: 4rem;
            font-weight: bold;
            width: 100px;
            text-align: center;
        }
        .btn-hp {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .btn-minus { background-color: #b71c1c; color: white; }
        .btn-plus { background-color: #1b5e20; color: white; }

        /* 旋轉按鈕 (針對面對面打牌) */
        .rotate-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: 1px solid #555;
            color: #888;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        /* 手機直向時的提示 */
        @media (orientation: portrait) {
            .orientation-warning { display: flex; }
        }
        .orientation-warning {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 999;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>

<!-- 直向使用時的警告 (建議橫向) -->
<div class="orientation-warning">
    <div>
        <h1>建議使用橫向模式</h1>
        <p>為了獲得最佳體驗（左側PP，右側HP），<br>請旋轉您的手機。</p>
        <button class="btn-start" onclick="this.parentElement.parentElement.style.display='none'">強制使用</button>
    </div>
</div>

<!-- SCREEN 1: 選擇領袖 -->
<div id="screen-select">
    <h2 style="margin-bottom: 30px;">選擇您的領袖 (Player)</h2>
    <div class="grid">
        <!-- 預設選項 -->
        <div class="leader-opt" onclick="selectLeader(this, 'https://via.placeholder.com/150/003366/FFFFFF?text=Elf')"><img src="https://via.placeholder.com/150/2E7D32/FFFFFF?text=Elf"></div>
        <div class="leader-opt" onclick="selectLeader(this, 'https://via.placeholder.com/150/FBC02D/000000?text=Royal')"><img src="https://via.placeholder.com/150/FBC02D/000000?text=Royal"></div>
        <div class="leader-opt" onclick="selectLeader(this, 'https://via.placeholder.com/150/1565C0/FFFFFF?text=Witch')"><img src="https://via.placeholder.com/150/1565C0/FFFFFF?text=Witch"></div>
        <div class="leader-opt" onclick="selectLeader(this, 'https://via.placeholder.com/150/424242/FFFFFF?text=Drag')"><img src="https://via.placeholder.com/150/424242/FFFFFF?text=Drag"></div>
        
        <!-- 上傳按鈕 -->
        <label class="leader-opt" style="background: #444; display: flex; justify-content: center; align-items: center;">
            <span style="font-size: 30px;">+</span>
            <input type="file" accept="image/*" style="display: none;" onchange="handleUpload(this)">
        </label>
    </div>
    <button class="btn-start" onclick="startGame()">BATTLE START</button>
</div>

<!-- SCREEN 2: 戰鬥介面 (Flex Layout) -->
<div id="screen-battle">
    
    <!-- 左側：PP 控制 (Vertical) -->
    <div class="left-panel-pp">
        <div class="pp-display-box">
            <div class="pp-label">PLAY POINT</div>
            <div class="pp-value" id="currentPP">0</div>
            <div class="pp-max">MAX: <span id="maxPP">0</span></div>
        </div>
        
        <div class="pp-controls">
            <div style="display: flex; gap: 5px;">
                <button class="btn-pp" style="flex:1" onclick="modPP(-1)">-1</button>
                <button class="btn-pp" style="flex:1" onclick="modPP(1)">+1</button>
            </div>
            <div class="pp-label" style="text-align: center; margin-top: 10px;">MAX PP</div>
            <div style="display: flex; gap: 5px;">
                <button class="btn-pp" style="flex:1" onclick="modMaxPP(-1)">-</button>
                <button class="btn-pp" style="flex:1" onclick="modMaxPP(1)">+</button>
            </div>
        </div>

        <button class="btn-turn-start" onclick="startTurn()">
            回合開始<br><span style="font-size: 0.8rem; font-weight: normal;">TURN START</span>
        </button>
        
        <div style="margin-top: auto; color: #666; font-size: 0.8rem;">
            Turn: <span id="turnCount">1</span>
        </div>
    </div>

    <!-- 右側：HP 顯示 (Top & Bottom) -->
    <div class="right-panel-hp">
        
        <!-- 上半部：對手 (Enemy) -->
        <div class="player-section enemy-area" id="enemySection">
            <button class="rotate-btn" onclick="rotateEnemy()">↻ 旋轉視角</button>
            <!-- 對手圖片 (預設) -->
            <img src="https://via.placeholder.com/150/000000/FFFFFF?text=Enemy" class="leader-avatar">
            
            <div class="hp-control-group">
                <button class="btn-hp btn-minus" onclick="modHP('enemy', -1)">-</button>
                <div class="hp-value" id="enemyHP">20</div>
                <button class="btn-hp btn-plus" onclick="modHP('enemy', 1)">+</button>
            </div>
        </div>

        <!-- 下半部：自己 (Self) -->
        <div class="player-section self-area">
            <!-- 自己的圖片 (動態載入) -->
            <img id="myAvatar" src="" class="leader-avatar">
            
            <div class="hp-control-group">
                <button class="btn-hp btn-minus" onclick="modHP('player', -1)">-</button>
                <div class="hp-value" id="playerHP">20</div>
                <button class="btn-hp btn-plus" onclick="modHP('player', 1)">+</button>
            </div>
        </div>

    </div>
</div>

<script>
    // 遊戲數據
    let state = {
        playerHP: 20,
        enemyHP: 20,
        currentPP: 0,
        maxPP: 0,
        turn: 1,
        imgSrc: '' // 存儲使用者選擇的圖片
    };

    // 1. 選擇圖片邏輯
    function selectLeader(el, src) {
        document.querySelectorAll('.leader-opt').forEach(d => d.classList.remove('selected'));
        el.classList.add('selected');
        state.imgSrc = src;
    }

    // 2. 上傳圖片邏輯
    function handleUpload(input) {
        if (input.files && input.files) {
            const reader = new FileReader();
            reader.onload = function(e) {
                state.imgSrc = e.target.result;
                // 視覺回饋：選中上傳鈕
                document.querySelectorAll('.leader-opt').forEach(d => d.classList.remove('selected'));
                input.parentElement.classList.add('selected');
                alert("圖片已讀取");
            };
            reader.readAsDataURL(input.files);
        }
    }

    // 3. 開始遊戲
    function startGame() {
        if (!state.imgSrc) { alert("請先選擇一張領袖圖片"); return; }
        
        document.getElementById('myAvatar').src = state.imgSrc;
        document.getElementById('screen-select').style.display = 'none';
        document.getElementById('screen-battle').style.display = 'flex'; // 重要：設為 flex 佈局
    }

    // 4. HP 控制邏輯 (支援兩人)
    function modHP(target, val) {
        if (target === 'player') {
            state.playerHP += val;
            document.getElementById('playerHP').innerText = state.playerHP;
        } else {
            state.enemyHP += val;
            document.getElementById('enemyHP').innerText = state.enemyHP;
        }
    }

    // 5. PP 控制邏輯
    function modPP(val) {
        const next = state.currentPP + val;
        if (next >= 0 && next <= state.maxPP) {
            state.currentPP = next;
            updatePPUI();
        }
    }

    function modMaxPP(val) {
        const next = state.maxPP + val;
        if (next >= 0 && next <= 10) {
            state.maxPP = next;
            updatePPUI();
        }
    }

    // 6. 回合開始邏輯 (參照官方規則)
    // 官方APP邏輯：Max PP +1 (上限10), Current PP 補滿, Turn +1
    function startTurn() {
        if (state.maxPP < 10) {
            state.maxPP += 1;
        }
        state.currentPP = state.maxPP; // 補滿
        state.turn += 1;
        
        updatePPUI();
        document.getElementById('turnCount').innerText = state.turn;
    }

    function updatePPUI() {
        document.getElementById('currentPP').innerText = state.currentPP;
        document.getElementById('maxPP').innerText = state.maxPP;
    }

    // 7. 額外功能：旋轉對手視角 (方便面對面打牌)
    let isRotated = false;
    function rotateEnemy() {
        const section = document.getElementById('enemySection');
        if (!isRotated) {
            section.style.transform = "rotate(180deg)";
        } else {
            section.style.transform = "none";
        }
        isRotated = !isRotated;
    }
</script>

</body>
</html>
